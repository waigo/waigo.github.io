<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/><link rel="shortcut icon" href="/img/logo.ico"/><link rel="shortcut icon" href="/img/logo.png"/><meta name="msapplication-TileColor" content="#fff"/><meta name="msapplication-TileImage" content="/img/logo.png"/><title>Middleware primer | Waigo.js</title><style>@import url('https://fonts.googleapis.com/css?family=Roboto Mono:300|Open Sans:300,400|Raleway:100,300,500');a,abbr,acronym,address,applet,big,blockquote,body,caption,cite,code,dd,del,dfn,div,dl,dt,em,fieldset,form,h1,h2,h3,h4,h5,h6,html,iframe,img,ins,kbd,label,legend,li,object,ol,p,pre,q,s,samp,small,span,strike,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,tt,ul,var{margin:0;padding:0;border:0;outline:0;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline}body{line-height:1;color:#000;background:#fff}ol,ul{list-style:none}table{border-collapse:separate;border-spacing:0}caption,table,td,th{vertical-align:middle}caption,td,th{text-align:left;font-weight:400}a img{border:none}*{box-sizing:border-box}@font-face{font-family:FontAwesome;src:url("/fonts/fontawesome-webfont.eot?v=4.6.1");src:url("/fonts/fontawesome-webfont.eot?#iefix&v=4.6.1") format('embedded-opentype'),url("/fonts/fontawesome-webfont.woff?v=4.6.1") format('woff'),url("/fonts/fontawesome-webfont.woff2?v=4.6.1") format('woff2'),url("/fonts/fontawesome-webfont.ttf?v=4.6.1") format('truetype'),url("/fonts/fontawesome-webfont.svg?v=4.6.1#fontawesomeregular") format('svg');font-weight:400;font-style:normal}.fa,.page.guide section.content a.github-edit-link:before,i.arrow.left:before,i.arrow.right:before,i.changelog:before,i.discuss:before,i.github:before,i.menu.open:before,i.menu:before,i.twitter:before{display:inline-block;font-family:FontAwesome;font-style:normal;font-weight:400;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.333333333333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.285714285714286em;text-align:center}.fa-ul{padding-left:0;margin-left:2.142857142857143em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.142857142857143em;width:2.142857142857143em;top:.142857142857143em;text-align:center}.fa-li.fa-lg{left:-1.857142857142857em}.fa-border{padding:.2em .25em .15em;border:.08em solid #eee;border-radius:.1em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left,.page.guide section.content a.github-edit-link:before.pull-left,i.arrow.left:before.pull-left,i.arrow.right:before.pull-left,i.changelog:before.pull-left,i.discuss:before.pull-left,i.github:before.pull-left,i.menu.open:before.pull-left,i.menu:before.pull-left,i.twitter:before.pull-left{margin-right:.3em}.fa.pull-right,.page.guide section.content a.github-edit-link:before.pull-right,i.arrow.left:before.pull-right,i.arrow.right:before.pull-right,i.changelog:before.pull-right,i.discuss:before.pull-right,i.github:before.pull-right,i.menu.open:before.pull-right,i.menu:before.pull-right,i.twitter:before.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:spin 2s infinite linear;animation:spin 2s infinite linear}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2);-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=0,mirror=1);-webkit-transform:scaleX(-1);transform:scaleX(-1)}.fa-flip-vertical{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2,mirror=1);-webkit-transform:scaleY(-1);transform:scaleY(-1)}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.page.home section.features-1 ul li .title,.page.home section.next-links>div a,.page.home section.quick-start h2,.page.home section.splash .actions a,.page.home section.splash p.tagline,footer .social a,footer .tagline,h1,h2,h3,header,header button.mobile-toggle,main.side-nav-layout button.nav.mobile{font-family:Raleway,Arial,sans-serif;font-weight:100;letter-spacing:1px}.page.home section.features-1 ul li .title,.page.home section.next-links>div a,.page.home section.splash .actions a,header button.mobile-toggle,main.side-nav-layout button.nav.mobile{font-weight:300}.page.home section.features-1 .intro,body,main.side-nav-layout aside,main.side-nav-layout aside li.active>a{font-family:Open Sans,Arial,sans-serif;font-weight:300}main.side-nav-layout aside li.active>a{font-weight:400}.page.guide section.content code,.page.home section.quick-start pre,.page.home section.splash .install{font-family:Roboto Mono,monospace;font-weight:300}mixin standard-box-shadow(){box-shadow:0 7px 26px -1px rgba(0,0,0,.53)}.page.guide section.content code[class*=hljs],.page.guide section.content img{max-width:100%;box-shadow:0 0 11px 0 rgba(0,0,0,.5)}html{font-size:16px}body{background-color:#fff;margin:0;padding:0}a{color:#3498db;text-decoration:none;border-bottom:1px solid #3498db;-webkit-transition:all .2s linear;transition:all .2s linear}a:hover{color:#fff;background-color:#3498db}.page{position:relative;min-height:100vh;width:100%}.page main{background-color:#fff;min-height:calc(100vh - 64px);padding:1em 1.5em 0}@media only screen and (max-width:500px){.page main{padding:1em}}strong{font-weight:bolder}i{display:inline-block;-webkit-transition:all .2s linear;transition:all .2s linear}i.twitter{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.twitter:before{content:"\F099"}i.github{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.github:before{content:"\F09B"}i.discuss{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.discuss:before{content:"\F086"}i.menu{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.menu:before{content:"\F0C9"}i.menu.open{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.menu.open:before{content:"\F0C9"}i.changelog{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.changelog:before{content:"\F126"}i.arrow.right{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}i.arrow.right:before{content:"\F101"}i.arrow.left{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(180deg);transform:rotate(180deg)}i.arrow.left:before{content:"\F101"}.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}header{position:relative;width:100%;height:64px;margin-bottom:1.5em;-webkit-transition:all .3s linear;transition:all .3s linear;background-color:#2c3e50;color:#fff}.page.home .headroom--unfixed header{background-color:#3498db;color:#fff;box-shadow:none}.page.home .headroom--pinned header{background-color:#2c3e50;color:#fff}header .brand{position:absolute;height:64px}header .brand a{text-decoration:none;padding:0 .5em;line-height:64px;font-size:1.5rem}header .brand a,header .brand a:hover{color:inherit;background-color:inherit;border-bottom:none}header .brand a:hover{border-radius:0}header ul.nav{position:absolute;height:64px;right:15px;list-style:none;display:-webkit-box;display:-ms-flexbox;display:box;display:flex;-webkit-box-orient:horizontal;-moz-box-orient:horizontal;-o-box-orient:horizontal;-webkit-box-lines:single;-moz-box-lines:single;-o-box-lines:single;-ms-flex-flow:row nowrap;flex-flow:row;-webkit-box-pack:center;-o-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-o-box-align:center;-ms-flex-align:center;align-items:center}header ul.nav li{display:inline-block;margin-right:1.3em}@media only screen and (max-width:800px){header ul.nav li{margin-right:1em}}header ul.nav li:last-child{margin-right:0}header ul.nav li a{color:#fff;text-decoration:none;border:1px solid transparent;-webkit-transition:all .2s linear;transition:all .2s linear;padding:0 .5em;border-radius:5px;font-size:1.2em;display:inline-block;height:100%;line-height:48px}header ul.nav li a.active,header ul.nav li a:hover{color:#fff;background-color:transparent;border:1px solid #fff}header ul.nav li.social{margin-right:.3em}header ul.nav li.social a{font-size:1em}@media only screen and (max-width:500px){header ul.nav{opacity:0;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter:alpha(opacity=0);z-index:10;pointer-events:none;-webkit-transition:opacity .3s linear;transition:opacity .3s linear;display:block;top:48px;height:auto;border-radius:10px;border:1px solid #2980b9;background-color:#2980b9}header ul.nav li{display:block;background-color:transparent;margin:0;border-bottom:1px solid #3498db}header ul.nav li.social{margin:0}header ul.nav li:last-child{border-bottom:none}header ul.nav li a{color:#fff;text-decoration:none;border:1px solid transparent;-webkit-transition:all .2s linear;transition:all .2s linear;padding:0 .5em;border-radius:5px;font-size:1em;display:block;border-radius:0;text-align:center;font-weight:bolder}header ul.nav li a.active,header ul.nav li a:hover{color:#2980b9;background-color:#fff;border:1px solid transparent}header ul.nav.active{opacity:1;-ms-filter:none;filter:none;pointer-events:auto}}header button.mobile-toggle{border-radius:10px;border:1px solid #fff;padding:.7em 1em;-webkit-transition:all .2s linear;transition:all .2s linear;color:#fff;background-color:transparent;display:none;position:absolute;right:15px;top:16px;width:32px;height:32px;padding:0;cursor:pointer}header button.mobile-toggle:hover{border-radius:10px;border:1px solid #fff;color:#3498db;background-color:#fff}header button.mobile-toggle i{display:block}@media only screen and (max-width:500px){header button.mobile-toggle{display:block}}footer{width:100%;height:50px;border-top:1px solid #ccc;padding:1em;margin-top:60px;color:#666;text-align:center}footer .tagline{margin:0 0 1em}footer .credits{font-size:50%}footer .social{margin-top:1em}footer .social a{text-decoration:none;display:inline-block;margin:0 .2em;width:24px;height:24px;opacity:.5;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";filter:alpha(opacity=50);-webkit-transition:all .3s linear;transition:all .3s linear}footer .social a,footer .social a:hover{color:inherit;background-color:inherit;border-bottom:none}footer .social a:hover{border-radius:0;opacity:1;-ms-filter:none;filter:none}main.side-nav-layout{padding-top:2em}main.side-nav-layout section.content{position:relative;display:inline-block;vertical-align:top;width:79%;padding-left:20px;font-size:1rem;line-height:1.5em;word-wrap:break-word}@media only screen and (max-width:500px){main.side-nav-layout section.content{width:100%;padding:0 1em}}main.side-nav-layout section.content .prev-next{display:-webkit-box;display:-ms-flexbox;display:box;display:flex;-webkit-box-orient:horizontal;-moz-box-orient:horizontal;-o-box-orient:horizontal;-webkit-box-lines:multiple;-moz-box-lines:multiple;-o-box-lines:multiple;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-box-pack:justify;-o-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-o-box-align:center;-ms-flex-align:center;align-items:center;margin-top:4em;font-size:75%;width:100%}main.side-nav-layout aside{display:inline-block;vertical-align:top;padding:0 20px 0 0;border-right:1px solid #ecf0f1;font-size:1rem;width:20%;overflow:hidden}main.side-nav-layout aside a{border-bottom:none}main.side-nav-layout aside a:hover{border-bottom:1px dashed #000}main.side-nav-layout aside li.active>a{font-size:140%;color:#000;border-bottom:1px dashed #000}main.side-nav-layout aside li.active>a:hover{color:#fff}main.side-nav-layout aside>ul>li{line-height:2em}main.side-nav-layout aside>ul>li>ul{display:none}main.side-nav-layout aside>ul>li.active>ul{color:#000;display:block;font-size:80%;margin:.7em 0 0 2em}main.side-nav-layout aside>ul>li.active>ul>li{line-height:1.8em}@media only screen and (max-width:500px){main.side-nav-layout aside{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2;left:-100vw;-webkit-transition:all .2s linear;transition:all .2s linear;overflow-y:scroll;background-color:#fff}main.side-nav-layout aside ul{margin:1em 0 0 4em}main.side-nav-layout aside.mobile.visible{left:0}}main.side-nav-layout button.nav.mobile{border-radius:10px;border:1px solid #2980b9;padding:.7em 1em;-webkit-transition:all .2s linear;transition:all .2s linear;color:#fff;background-color:#2980b9;cursor:pointer;display:none;position:fixed;top:64px;left:0;padding:.2em .3em;font-size:1.5rem;border-top-left-radius:0;border-bottom-left-radius:0;border-left:none;z-index:4}main.side-nav-layout button.nav.mobile:hover{border-radius:10px;border:1px solid #3498db;color:#fff;background-color:#3498db;border-top-left-radius:0;border-bottom-left-radius:0;border-left:none}@media only screen and (max-width:500px){main.side-nav-layout button.nav.mobile{display:block}}.page.home{position:relative}.page.home .headroom-wrapper{background-color:#3498db}@media only screen and (max-width:500px){.page.home .headroom-wrapper{height:64px!important}}.page.home main{padding:0;margin-top:-1px}.page.home section.splash{height:calc(100vh - 64px);background-color:#3498db;display:-webkit-box;display:-ms-flexbox;display:box;display:flex;-webkit-box-orient:vertical;-moz-box-orient:vertical;-o-box-orient:vertical;-webkit-box-lines:single;-moz-box-lines:single;-o-box-lines:single;-ms-flex-flow:column nowrap;flex-flow:column;-webkit-box-pack:center;-o-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-o-box-align:center;-ms-flex-align:center;align-items:center;color:#fff;font-size:1.7rem;text-align:center}@media only screen and (max-width:500px){.page.home section.splash{font-size:1.3rem}}.page.home section.splash .logo{display:block;-webkit-transition:all .3s linear;transition:all .3s linear;width:144px;height:144px;margin:0 0 .5em;background-image:url("/img/logo.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.splash .logo{background-image:url("/img/logo@2x.png");background-size:contain}}@media only screen and (max-width:500px){.page.home section.splash .logo{width:96px;height:96px}}.page.home section.splash p.tagline{margin:.7em 0;font-size:120%;line-height:1.2em;width:50%}@media only screen and (max-width:800px){.page.home section.splash p.tagline{width:80%;margin-bottom:0}}.page.home section.splash .actions{margin:1em 0 2em}@media only screen and (max-width:500px){.page.home section.splash .actions{margin-bottom:1em}}.page.home section.splash .actions a{border-radius:10px;border:1px solid #fff;padding:.7em 1em;-webkit-transition:all .2s linear;transition:all .2s linear;color:#fff;background-color:transparent;cursor:pointer;font-size:80%;margin:0 .5em}.page.home section.splash .actions a:hover{border-radius:10px;border:1px solid #fff;color:#3498db;background-color:#fff}@media only screen and (max-width:500px){.page.home section.splash .actions a{display:block;margin:.5em auto;font-size:100%}}.page.home section.splash .install{font-size:60%;padding:.3em .4em;background-color:#2c3e50;border-radius:5px}.page.home section.splash .meta{margin-top:1.2em}.page.home section.splash .meta a{text-decoration:none;border:1px solid transparent;-webkit-transition:all .2s linear;transition:all .2s linear;padding:0 .5em;border-radius:5px;font-size:50%;color:#fff;margin:0 .5em}.page.home section.splash .meta a.active,.page.home section.splash .meta a:hover{color:#000;background-color:#fff;border:1px solid transparent}.page.home section.splash .meta a i+span{margin-left:.3em}.page.home section.features-1{padding:1em}.page.home section.features-1 .intro{width:80%;font-size:2.2rem;text-align:center;margin:1em auto 1.5em;line-height:1.5em}@media only screen and (max-width:500px){.page.home section.features-1 .intro{font-size:1.8rem}}.page.home section.features-1 ul{display:-webkit-box;display:-ms-flexbox;display:box;display:flex;-webkit-box-orient:horizontal;-moz-box-orient:horizontal;-o-box-orient:horizontal;-webkit-box-lines:multiple;-moz-box-lines:multiple;-o-box-lines:multiple;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-box-pack:justify;-o-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:start;-o-box-align:start;-ms-flex-align:start;align-items:flex-start;margin:0 auto;width:90%}@media only screen and (max-width:800px){.page.home section.features-1 ul{width:100%}}@media only screen and (max-width:500px){.page.home section.features-1 ul{-webkit-box-orient:vertical;-moz-box-orient:vertical;-o-box-orient:vertical;-webkit-box-lines:single;-moz-box-lines:single;-o-box-lines:single;-ms-flex-flow:column nowrap;flex-flow:column}}.page.home section.features-1 ul li{display:block;width:30%;font-size:1rem;margin:1.5em auto}@media only screen and (max-width:800px){.page.home section.features-1 ul li{width:40%}}@media only screen and (max-width:500px){.page.home section.features-1 ul li{display:block;width:100%}}.page.home section.features-1 ul li .title{display:inline-block;font-size:140%}.page.home section.features-1 ul li .title:before{display:inline-block;vertical-align:top;margin:0 .5em .3em 0;content:" ";width:32px;height:32px}.page.home section.features-1 ul li .description{margin-top:1em;line-height:1.4em}.page.home section.features-1 ul li:nth-child(1) .title:before{background-image:url("/img/icon-rocket.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(1) .title:before{background-image:url("/img/icon-rocket@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(2) .title:before{background-image:url("/img/icon-plugin.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(2) .title:before{background-image:url("/img/icon-plugin@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(3) .title:before{background-image:url("/img/icon-text-field.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(3) .title:before{background-image:url("/img/icon-text-field@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(4) .title:before{background-image:url("/img/icon-routing.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(4) .title:before{background-image:url("/img/icon-routing@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(5) .title:before{background-image:url("/img/icon-template.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(5) .title:before{background-image:url("/img/icon-template@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(6) .title:before{background-image:url("/img/icon-users.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(6) .title:before{background-image:url("/img/icon-users@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(7) .title:before{background-image:url("/img/icon-email.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(7) .title:before{background-image:url("/img/icon-email@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(8) .title:before{background-image:url("/img/icon-cron.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(8) .title:before{background-image:url("/img/icon-cron@2x.png");background-size:contain}}.page.home section.features-1 ul li:nth-child(9) .title:before{background-image:url("/img/icon-setup.png");background-size:contain;background-repeat:no-repeat;background-position:50%}@media (min--moz-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5),(min-resolution:1.5dppx),(min-resolution:138dpi),all and (-webkit-min-device-pixel-ratio:1.5){.page.home section.features-1 ul li:nth-child(9) .title:before{background-image:url("/img/icon-setup@2x.png");background-size:contain}}.page.home section.quick-start{margin:2em 0;background-color:#2c3e50;padding:3em 1em;color:#fff;text-align:center;font-size:1rem}@media only screen and (max-width:500px){.page.home section.quick-start{padding:1em;font-size:.8rem}}.page.home section.quick-start .wrapper{display:inline-block;width:80%;text-align:left}@media only screen and (max-width:500px){.page.home section.quick-start .wrapper{width:100%}}.page.home section.quick-start h2{display:block;font-size:200%;margin-bottom:.8em}.page.home section.quick-start div,.page.home section.quick-start pre{display:inline-block}.page.home section.quick-start pre{line-height:1.5em;background-color:#000;width:40%;padding:1em;margin-right:2em}.page.home section.quick-start div{vertical-align:top;width:50%;font-size:110%;line-height:1.3em}.page.home section.quick-start div p{margin-bottom:1em}@media only screen and (max-width:800px){.page.home section.quick-start pre{display:block;width:100%}.page.home section.quick-start div{display:block;margin-top:1.5em;line-height:1.5em;width:100%}}.page.home section.next-links{margin-top:2em;display:-webkit-box;display:-ms-flexbox;display:box;display:flex;-webkit-box-orient:horizontal;-moz-box-orient:horizontal;-o-box-orient:horizontal;-webkit-box-lines:multiple;-moz-box-lines:multiple;-o-box-lines:multiple;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-box-pack:center;-o-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-o-box-align:center;-ms-flex-align:center;align-items:center;font-size:1rem}.page.home section.next-links>div{margin:2em 0;text-align:center}@media only screen and (max-width:500px){.page.home section.next-links>div{margin:1em 0}}.page.home section.next-links>div a{border-radius:10px;border:1px solid #3498db;padding:.7em 1em;-webkit-transition:all .2s linear;transition:all .2s linear;color:#3498db;background-color:transparent;cursor:pointer;display:inline-block;margin:0 .5em;font-size:140%}.page.home section.next-links>div a:hover{border-radius:10px;border:1px solid #3498db;color:#fff;background-color:#3498db}.page.home section.next-links>div p{width:70%;margin:1em auto 0;line-height:1.2em}.page.guide{position:relative}.page.guide section.content h1{font-size:250%;margin:0 0 1em;line-height:1em}.page.guide section.content h2{font-size:160%;margin:1.5em 0 1em;line-height:1em}.page.guide section.content h3{font-size:130%;margin:1.5em 0 1em;line-height:1em}.page.guide section.content p{margin:1em 0}.page.guide section.content em{font-style:italic;font-size:90%}.page.guide section.content ol{list-style:decimal}.page.guide section.content ul{list-style:disc}.page.guide section.content ol,.page.guide section.content ul{margin:1em 0 1em 3em}.page.guide section.content ol li,.page.guide section.content ul li{padding:.2em 0}.page.guide section.content code[class*=hljs]{display:block;border-radius:5px;word-wrap:normal;margin-bottom:1.7em}.page.guide section.content code:not([class*=hljs]){display:inline;font-size:110%;padding:.1em .2em;background-color:#ecf0f1;border-radius:5px}.page.guide section.content a.github-edit-link{border-bottom:none;position:absolute;font-size:70%;text-transform:lowercase;top:0;right:0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(0deg);transform:rotate(0deg)}.page.guide section.content a.github-edit-link:before{content:"\F044";margin-right:.2em}.page.api{position:relative}.page.api main.side-nav-layout aside{font-size:.8rem}</style></head><body><div id="react-mount"><div class="page guide" data-reactroot="" data-reactid="1" data-react-checksum="594115142"><div class="headroom-wrapper" data-reactid="2"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);" class="headroom headroom--unfixed" data-reactid="3"><header data-reactid="4"><section class="brand" data-reactid="5"><a href="/" data-reactid="6">Waigo.js</a></section><button class="mobile-toggle" data-reactid="7"><i class="menu" data-reactid="8"></i></button><ul class="nav" data-reactid="9"><li class="" data-reactid="10"><a title="Documentation guide" class="active" href="/docs/introduction/motivation/" data-reactid="11">Guide</a></li><li class="" data-reactid="12"><a title="API docs" class="" href="/api/" data-reactid="13">API</a></li><li class="social" data-reactid="14"><a title="Twitter" href="https://twitter.com/waigojs" class="" data-reactid="15"><i class="twitter" data-reactid="16"></i></a></li><li class="social" data-reactid="17"><a title="Github" href="https://github.com/waigo/waigo" class="" data-reactid="18"><i class="github" data-reactid="19"></i></a></li><li class="social" data-reactid="20"><a title="Discuss" href="https://discord.gg/Jf3pGjf" class="" data-reactid="21"><i class="discuss" data-reactid="22"></i></a></li></ul></header></div></div><main class="side-nav-layout" data-reactid="23"><button class="nav mobile" title="Toggle nav menu" data-reactid="24"><i class="arrow right" data-reactid="25"></i></button><aside class="" data-reactid="26"><ul data-reactid="27"><li class="active" data-reactid="28"><a href="/docs/introduction/" data-reactid="29">Introduction</a><ul data-reactid="30"><li class="" data-reactid="31"><a href="/docs/introduction/motivation/" data-reactid="32">Motivation</a></li><li class="active" data-reactid="33"><a href="/docs/introduction/middlewareprimer/" data-reactid="34">Middleware primer</a></li><li class="" data-reactid="35"><a href="/docs/introduction/folderstructure/" data-reactid="36">Folder structure</a></li><li class="" data-reactid="37"><a href="/docs/introduction/codingstandard/" data-reactid="38">Coding standard</a></li></ul></li><li class="" data-reactid="39"><a href="/docs/gettingstarted/" data-reactid="40">Getting Started</a><ul data-reactid="41"><li class="" data-reactid="42"><a href="/docs/gettingstarted/requirements/" data-reactid="43">Requirements</a></li><li class="" data-reactid="44"><a href="/docs/gettingstarted/installation/" data-reactid="45">Installation</a></li><li class="" data-reactid="46"><a href="/docs/gettingstarted/runninghelloworld/" data-reactid="47">Running &quot;Hello World&quot;</a></li><li class="" data-reactid="48"><a href="/docs/gettingstarted/buildworkflowlivereload/" data-reactid="49">Build workflow and Live reload</a></li></ul></li><li class="" data-reactid="50"><a href="/docs/extendandoverride/" data-reactid="51">Extend and Override</a><ul data-reactid="52"><li class="" data-reactid="53"><a href="/docs/extendandoverride/moduleloader/" data-reactid="54">Module Loader</a></li><li class="" data-reactid="55"><a href="/docs/extendandoverride/usingplugins/" data-reactid="56">Using Plugins</a></li><li class="" data-reactid="57"><a href="/docs/extendandoverride/creatingplugins/" data-reactid="58">Creating Plugins</a></li></ul></li><li class="" data-reactid="59"><a href="/docs/commandline/" data-reactid="60">Command-Line (CLI)</a><ul data-reactid="61"><li class="" data-reactid="62"><a href="/docs/commandline/usingthecli/" data-reactid="63">Using the CLI</a></li><li class="" data-reactid="64"><a href="/docs/commandline/creatingcustomcommands/" data-reactid="65">Creating custom commands</a></li></ul></li><li class="" data-reactid="66"><a href="/docs/appconfiguration/" data-reactid="67">App configuration</a><ul data-reactid="68"><li class="" data-reactid="69"><a href="/docs/appconfiguration/appobject/" data-reactid="70">App object</a></li><li class="" data-reactid="71"><a href="/docs/appconfiguration/configuration/" data-reactid="72">Configuration</a></li><li class="" data-reactid="73"><a href="/docs/appconfiguration/startupsteps/" data-reactid="74">Startup steps</a></li><li class="" data-reactid="75"><a href="/docs/appconfiguration/shutdownsteps/" data-reactid="76">Shutdown steps</a></li></ul></li><li class="" data-reactid="77"><a href="/docs/logging/" data-reactid="78">Logging</a><ul data-reactid="79"><li class="" data-reactid="80"><a href="/docs/logging/howtouse/" data-reactid="81">How to use</a></li><li class="" data-reactid="82"><a href="/docs/logging/subcategories/" data-reactid="83">Sub-categories</a></li></ul></li><li class="" data-reactid="84"><a href="/docs/events/" data-reactid="85">Events</a></li><li class="" data-reactid="86"><a href="/docs/errorhandling/" data-reactid="87">Error handling</a><ul data-reactid="88"><li class="" data-reactid="89"><a href="/docs/errorhandling/builtinerrorclasses/" data-reactid="90">Built-in Error classes</a></li><li class="" data-reactid="91"><a href="/docs/errorhandling/creatingyourown/" data-reactid="92">Creating your own</a></li><li class="" data-reactid="93"><a href="/docs/errorhandling/errormiddleware/" data-reactid="94">Error middleware</a></li></ul></li><li class="" data-reactid="95"><a href="/docs/middleware/" data-reactid="96">Middleware</a><ul data-reactid="97"><li class="" data-reactid="98"><a href="/docs/middleware/defining/" data-reactid="99">Defining</a></li><li class="" data-reactid="100"><a href="/docs/middleware/configuring/" data-reactid="101">Configuring</a></li><li class="" data-reactid="102"><a href="/docs/middleware/commonmiddleware/" data-reactid="103">Common middleware</a></li></ul></li><li class="" data-reactid="104"><a href="/docs/controllers/" data-reactid="105">Controllers</a></li><li class="" data-reactid="106"><a href="/docs/databaseandmodels/" data-reactid="107">Database and Models</a><ul data-reactid="108"><li class="" data-reactid="109"><a href="/docs/databaseandmodels/databaseconnections/" data-reactid="110">Database connections</a></li><li class="" data-reactid="111"><a href="/docs/databaseandmodels/overviewofmodels/" data-reactid="112">Overview of models</a></li><li class="" data-reactid="113"><a href="/docs/databaseandmodels/definingandusingmodels/" data-reactid="114">Defining and using models</a></li><li class="" data-reactid="115"><a href="/docs/databaseandmodels/builtinmodels/" data-reactid="116">Built-in models</a></li><li class="" data-reactid="117"><a href="/docs/databaseandmodels/reactiveupdates/" data-reactid="118">Reactive updates</a></li></ul></li><li class="" data-reactid="119"><a href="/docs/routing/" data-reactid="120">Routing</a><ul data-reactid="121"><li class="" data-reactid="122"><a href="/docs/routing/howtouse/" data-reactid="123">How to use</a></li><li class="" data-reactid="124"><a href="/docs/routing/generatingurls/" data-reactid="125">Generating URLs</a></li><li class="" data-reactid="126"><a href="/docs/routing/singlepageapps/" data-reactid="127">Single-page apps</a></li></ul></li><li class="" data-reactid="128"><a href="/docs/renderingoutput/" data-reactid="129">Rendering output</a><ul data-reactid="130"><li class="" data-reactid="131"><a href="/docs/renderingoutput/enabling/" data-reactid="132">Enabling</a></li><li class="" data-reactid="133"><a href="/docs/renderingoutput/renderingmethods/" data-reactid="134">Rendering methods</a></li><li class="" data-reactid="135"><a href="/docs/renderingoutput/jsonoutput/" data-reactid="136">JSON output</a></li><li class="" data-reactid="137"><a href="/docs/renderingoutput/settingoutputformat/" data-reactid="138">Setting the output format</a></li><li class="" data-reactid="139"><a href="/docs/renderingoutput/customformats/" data-reactid="140">Custom formats</a></li></ul></li><li class="" data-reactid="141"><a href="/docs/viewtemplates/" data-reactid="142">View templates</a><ul data-reactid="143"><li class="" data-reactid="144"><a href="/docs/viewtemplates/templatedata/" data-reactid="145">Template data</a></li><li class="" data-reactid="146"><a href="/docs/viewtemplates/contextlevelandappleveldata/" data-reactid="147">Context-level and app-level data</a></li></ul></li><li class="" data-reactid="148"><a href="/docs/staticresources/" data-reactid="149">Static resources</a><ul data-reactid="150"><li class="" data-reactid="151"><a href="/docs/staticresources/collationofstaticresources/" data-reactid="152">Collation of static resources</a></li><li class="" data-reactid="153"><a href="/docs/staticresources/requestmiddleware/" data-reactid="154">Request middleware</a></li><li class="" data-reactid="155"><a href="/docs/staticresources/generatingurlpaths/" data-reactid="156">Generating URL paths</a></li></ul></li><li class="" data-reactid="157"><a href="/docs/sessions/" data-reactid="158">Sessions</a></li><li class="" data-reactid="159"><a href="/docs/forms/" data-reactid="160">Forms</a><ul data-reactid="161"><li class="" data-reactid="162"><a href="/docs/forms/definingandusing/" data-reactid="163">Defining and using</a></li><li class="" data-reactid="164"><a href="/docs/forms/stateanddirtychecking/" data-reactid="165">State and dirty-checking</a></li><li class="" data-reactid="166"><a href="/docs/forms/sanitizers/" data-reactid="167">Sanitizers</a></li><li class="" data-reactid="168"><a href="/docs/forms/validators/" data-reactid="169">Validators</a></li><li class="" data-reactid="170"><a href="/docs/forms/postvalidationhooks/" data-reactid="171">Post-validation hooks</a></li><li class="" data-reactid="172"><a href="/docs/forms/builtinfieldtypes/" data-reactid="173">Built-in field types</a></li><li class="" data-reactid="174"><a href="/docs/forms/customfieldtypes/" data-reactid="175">Custom field types</a></li></ul></li><li class="" data-reactid="176"><a href="/docs/scaling/" data-reactid="177">Scaling</a><ul data-reactid="178"><li class="" data-reactid="179"><a href="/docs/scaling/multiprocessclustering/" data-reactid="180">Multi-process clustering</a></li></ul></li><li class="" data-reactid="181"><a href="/docs/bestpractices/" data-reactid="182">Best practices</a></li></ul></aside><section class="content" data-reactid="183"><div data-reactid="184"><a class="github-edit-link" href="https://github.com/waigo/waigo/tree/master/docs/Introduction/MiddlewarePrimer.md" data-reactid="185">Edit page</a><div data-reactid="186"><h1 data-reactid="187">Middleware primer</h1><!-- react-text: 188 -->
<!-- /react-text --><p data-reactid="189"><em data-reactid="190">Note: This section gives a short primer on middleware functions and how they works in Express and Koa. If you’re already familiar with this you can skip to the next section.</em></p><!-- react-text: 191 -->
<!-- /react-text --><p data-reactid="192">Middleware functions form the foundation of most web development in Node.js. They allow you to easily elegantly “chain” together different pieces of logic which are to be executed for incoming web requests.</p><!-- react-text: 193 -->
<!-- /react-text --><p data-reactid="194"><!-- react-text: 195 -->Let’s consider a basic Express application which prints <!-- /react-text --><em data-reactid="196">“Hello World!”</em><!-- react-text: 197 -->. Our application will expect the user to have passed in a secret string as a URL query parameter in order to work. If this query parameter is omitted we want the response to be an error.<!-- /react-text --></p><!-- react-text: 198 -->
<!-- /react-text --><p data-reactid="199">Here is the code:</p><!-- react-text: 200 -->
<!-- /react-text --><pre data-reactid="201"><code class="language-js hljs" data-reactid="202"><span class="hljs-keyword" data-reactid="203">var</span><!-- react-text: 204 --> express = <!-- /react-text --><span class="hljs-built_in" data-reactid="205">require</span><!-- react-text: 206 -->(<!-- /react-text --><span class="hljs-string" data-reactid="207">&#x27;express&#x27;</span><!-- react-text: 208 -->);

<!-- /react-text --><span class="hljs-comment" data-reactid="209">// create new Express app instance</span><!-- react-text: 210 -->
<!-- /react-text --><span class="hljs-keyword" data-reactid="211">var</span><!-- react-text: 212 --> app = express();

<!-- /react-text --><span class="hljs-comment" data-reactid="213">// middleware to check secret</span><!-- react-text: 214 -->
app.use(<!-- /react-text --><span class="hljs-function" data-reactid="215"><span class="hljs-keyword" data-reactid="216">function</span><!-- react-text: 217 --> <!-- /react-text --><span class="hljs-title" data-reactid="218">checkSecret</span><!-- react-text: 219 -->(<!-- /react-text --><span class="hljs-params" data-reactid="220">req, res, next</span><!-- react-text: 221 -->) <!-- /react-text --></span><!-- react-text: 222 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="223">if</span><!-- react-text: 224 --> (<!-- /react-text --><span class="hljs-string" data-reactid="225">&#x27;waigo&#x27;</span><!-- react-text: 226 --> !== req.query.secret) {
    next(<!-- /react-text --><span class="hljs-keyword" data-reactid="227">new</span><!-- react-text: 228 --> <!-- /react-text --><span class="hljs-built_in" data-reactid="229">Error</span><!-- react-text: 230 -->(<!-- /react-text --><span class="hljs-string" data-reactid="231">&#x27;Wrong secret!&#x27;</span><!-- react-text: 232 -->));
  } <!-- /react-text --><span class="hljs-keyword" data-reactid="233">else</span><!-- react-text: 234 --> {
    next();
  }
});

<!-- /react-text --><span class="hljs-comment" data-reactid="235">// middleware to serve up content</span><!-- react-text: 236 -->
app.get(<!-- /react-text --><span class="hljs-string" data-reactid="237">&#x27;/&#x27;</span><!-- react-text: 238 -->, <!-- /react-text --><span class="hljs-function" data-reactid="239"><span class="hljs-keyword" data-reactid="240">function</span><!-- react-text: 241 --> <!-- /react-text --><span class="hljs-title" data-reactid="242">serveContent</span><!-- react-text: 243 -->(<!-- /react-text --><span class="hljs-params" data-reactid="244">req, res, next</span><!-- react-text: 245 -->) <!-- /react-text --></span><!-- react-text: 246 -->{
  res.send(<!-- /react-text --><span class="hljs-string" data-reactid="247">&#x27;Hello World!&#x27;</span><!-- react-text: 248 -->);
});

<!-- /react-text --><span class="hljs-comment" data-reactid="249">// middleware to handle errors</span><!-- react-text: 250 -->
app.use(<!-- /react-text --><span class="hljs-function" data-reactid="251"><span class="hljs-keyword" data-reactid="252">function</span><!-- react-text: 253 --> <!-- /react-text --><span class="hljs-title" data-reactid="254">handleError</span><!-- react-text: 255 -->(<!-- /react-text --><span class="hljs-params" data-reactid="256">err, req, res, next</span><!-- react-text: 257 -->) <!-- /react-text --></span><!-- react-text: 258 -->{
  res.send(err.toString());
});

<!-- /react-text --><span class="hljs-comment" data-reactid="259">// last step - kickstart the HTTP listening server</span><!-- react-text: 260 -->
app.listen(<!-- /react-text --><span class="hljs-number" data-reactid="261">3000</span><!-- react-text: 262 -->, <!-- /react-text --><span class="hljs-function" data-reactid="263"><span class="hljs-keyword" data-reactid="264">function</span><!-- react-text: 265 --> (<!-- /react-text --><span class="hljs-params" data-reactid="266"></span><!-- react-text: 267 -->) <!-- /react-text --></span><!-- react-text: 268 -->{
  <!-- /react-text --><span class="hljs-built_in" data-reactid="269">console</span><!-- react-text: 270 -->.log(<!-- /react-text --><span class="hljs-string" data-reactid="271">&#x27;Example app listening on port 3000!&#x27;</span><!-- react-text: 272 -->);
});
<!-- /react-text --></code></pre><!-- react-text: 273 -->
<!-- /react-text --><p data-reactid="274"><!-- react-text: 275 -->As you can see, each middleware is essentially a function which gets passed the current request object  (<!-- /react-text --><code data-reactid="276">req</code><!-- react-text: 277 -->), response object (<!-- /react-text --><code data-reactid="278">res</code><!-- react-text: 279 -->) and a callback (<!-- /react-text --><code data-reactid="280">next</code><!-- react-text: 281 -->) which points to the next middleware in the chain:<!-- /react-text --></p><!-- react-text: 282 -->
<!-- /react-text --><pre data-reactid="283"><code class="language-js hljs" data-reactid="284"><span class="hljs-function" data-reactid="285"><span class="hljs-keyword" data-reactid="286">function</span><!-- react-text: 287 -->(<!-- /react-text --><span class="hljs-params" data-reactid="288">req, res, next</span><!-- react-text: 289 -->) <!-- /react-text --></span><!-- react-text: 290 -->{ ... }
<!-- /react-text --></code></pre><!-- react-text: 291 -->
<!-- /react-text --><p data-reactid="292"><!-- react-text: 293 -->However the error handling middleware is special, and gets an additional <!-- /react-text --><code data-reactid="294">err</code><!-- react-text: 295 --> argument at the beginning:<!-- /react-text --></p><!-- react-text: 296 -->
<!-- /react-text --><pre data-reactid="297"><code class="language-js hljs" data-reactid="298"><span class="hljs-function" data-reactid="299"><span class="hljs-keyword" data-reactid="300">function</span><!-- react-text: 301 -->(<!-- /react-text --><span class="hljs-params" data-reactid="302">err, req, res, next</span><!-- react-text: 303 -->) <!-- /react-text --></span><!-- react-text: 304 -->{ ... }
<!-- /react-text --></code></pre><!-- react-text: 305 -->
<!-- /react-text --><p data-reactid="306"><!-- react-text: 307 -->Each middleware function must call <!-- /react-text --><code data-reactid="308">next()</code><!-- react-text: 309 --> in order for the next middleware in the chain to execute. If <!-- /react-text --><code data-reactid="310">next()</code><!-- react-text: 311 --> is called with an error object (like we do above if the <!-- /react-text --><code data-reactid="312">secret</code><!-- react-text: 313 --> query value is incorrect) then Express will skip subsequent middleware functions until it finds the available error handling middleware.<!-- /react-text --></p><!-- react-text: 314 -->
<!-- /react-text --><p data-reactid="315"><!-- react-text: 316 -->Notice above that the second middleware function does not call <!-- /react-text --><code data-reactid="317">next()</code><!-- react-text: 318 -->. This is a <!-- /react-text --><em data-reactid="319">route handler</em><!-- react-text: 320 --> middleware and is intended to handle all HTTP GET requests to the root URL path (<!-- /react-text --><code data-reactid="321">/</code><!-- react-text: 322 -->) and return a response. Because it doesn’t call <!-- /react-text --><code data-reactid="323">next()</code><!-- react-text: 324 --> any middleware defined after this one wouldn’t normally get executed.<!-- /react-text --></p><!-- react-text: 325 -->
<!-- /react-text --><p data-reactid="326">At this point you may be wondering - why do we need an error handler middleware for the above logic? surely we can do it all in the route handler, like so:</p><!-- react-text: 327 -->
<!-- /react-text --><pre data-reactid="328"><code class="language-js hljs" data-reactid="329"><!-- react-text: 330 -->app.get(<!-- /react-text --><span class="hljs-string" data-reactid="331">&#x27;/&#x27;</span><!-- react-text: 332 -->, <!-- /react-text --><span class="hljs-function" data-reactid="333"><span class="hljs-keyword" data-reactid="334">function</span><!-- react-text: 335 --> <!-- /react-text --><span class="hljs-title" data-reactid="336">serveContent</span><!-- react-text: 337 -->(<!-- /react-text --><span class="hljs-params" data-reactid="338">req, res, next</span><!-- react-text: 339 -->) <!-- /react-text --></span><!-- react-text: 340 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="341">if</span><!-- react-text: 342 --> (<!-- /react-text --><span class="hljs-string" data-reactid="343">&#x27;waigo&#x27;</span><!-- react-text: 344 --> !== req.query.secret) {
    res.send(<!-- /react-text --><span class="hljs-string" data-reactid="345">&#x27;Error: Wrong secret!&#x27;</span><!-- react-text: 346 -->);
  } <!-- /react-text --><span class="hljs-keyword" data-reactid="347">else</span><!-- react-text: 348 --> {
    res.send(<!-- /react-text --><span class="hljs-string" data-reactid="349">&#x27;Hello World!&#x27;</span><!-- react-text: 350 -->);
  }
});
<!-- /react-text --></code></pre><!-- react-text: 351 -->
<!-- /react-text --><p data-reactid="352">Absolutely. The original example is deliberately more complex just so that we can illustrate the concepts better. In the original example, the secret-checking middlware will be executed for every incoming request. The error handler middleware will handle errors propagated from any middleware further up the chain.</p><!-- react-text: 353 -->
<!-- /react-text --><p data-reactid="354"><!-- react-text: 355 -->A note regarding route handlers. Typically you will define a route handler for every URL route in your app - using <!-- /react-text --><code data-reactid="356">app.get()</code><!-- react-text: 357 -->, <!-- /react-text --><code data-reactid="358">app.post()</code><!-- react-text: 359 -->, <!-- /react-text --><code data-reactid="360">app.put()</code><!-- react-text: 361 -->, etc according to the HTTP method you wish to specify. Furthermore, you would typically define these route handlers after defining middleware that is common to every route - using <!-- /react-text --><code data-reactid="362">app.use()</code><!-- react-text: 363 -->.<!-- /react-text --></p><!-- react-text: 364 -->
<!-- /react-text --><h2 data-reactid="365">Koa middleware</h2><!-- react-text: 366 -->
<!-- /react-text --><p data-reactid="367">Let’s now look at how middleware in Koa is different from and improves upon what’s in Express.</p><!-- react-text: 368 -->
<!-- /react-text --><p data-reactid="369"><!-- react-text: 370 -->Koa middleware functions are <!-- /react-text --><a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/function*" data-reactid="371">generator functions</a><!-- react-text: 372 -->. This immediately makes for powerful middleware composition. Rewriting the previous example in Koa gives us:<!-- /react-text --></p><!-- react-text: 373 -->
<!-- /react-text --><pre data-reactid="374"><code class="language-js hljs" data-reactid="375"><span class="hljs-keyword" data-reactid="376">const</span><!-- react-text: 377 --> koa = <!-- /react-text --><span class="hljs-built_in" data-reactid="378">require</span><!-- react-text: 379 -->(<!-- /react-text --><span class="hljs-string" data-reactid="380">&#x27;koa&#x27;</span><!-- react-text: 381 -->);

<!-- /react-text --><span class="hljs-comment" data-reactid="382">// create new koa app</span><!-- react-text: 383 -->
<!-- /react-text --><span class="hljs-keyword" data-reactid="384">const</span><!-- react-text: 385 --> app = koa();

<!-- /react-text --><span class="hljs-comment" data-reactid="386">// error handler first!</span><!-- react-text: 387 -->
app.use(<!-- /react-text --><span class="hljs-function" data-reactid="388"><span class="hljs-keyword" data-reactid="389">function</span><!-- react-text: 390 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="391">next</span><!-- react-text: 392 -->) <!-- /react-text --></span><!-- react-text: 393 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="394">try</span><!-- react-text: 395 --> {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="396">yield</span><!-- react-text: 397 --> next;
  } <!-- /react-text --><span class="hljs-keyword" data-reactid="398">catch</span><!-- react-text: 399 --> (err) {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="400">this</span><!-- react-text: 401 -->.response.send(err.toString());
  }
});

<!-- /react-text --><span class="hljs-comment" data-reactid="402">// middleware to check the secret</span><!-- react-text: 403 -->
app.use(<!-- /react-text --><span class="hljs-function" data-reactid="404"><span class="hljs-keyword" data-reactid="405">function</span><!-- react-text: 406 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="407">next</span><!-- react-text: 408 -->) <!-- /react-text --></span><!-- react-text: 409 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="410">if</span><!-- react-text: 411 --> (<!-- /react-text --><span class="hljs-string" data-reactid="412">&#x27;waigo&#x27;</span><!-- react-text: 413 --> !== <!-- /react-text --><span class="hljs-keyword" data-reactid="414">this</span><!-- react-text: 415 -->.request.query.secret) {
    <!-- /react-text --><span class="hljs-keyword" data-reactid="416">throw</span><!-- react-text: 417 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="418">new</span><!-- react-text: 419 --> <!-- /react-text --><span class="hljs-built_in" data-reactid="420">Error</span><!-- react-text: 421 -->(<!-- /react-text --><span class="hljs-string" data-reactid="422">&#x27;Wrong secret!&#x27;</span><!-- react-text: 423 -->);
  }
  
  <!-- /react-text --><span class="hljs-keyword" data-reactid="424">yield</span><!-- react-text: 425 --> next;
});

<!-- /react-text --><span class="hljs-comment" data-reactid="426">// route handler</span><!-- react-text: 427 -->
app.get(<!-- /react-text --><span class="hljs-function" data-reactid="428"><span class="hljs-keyword" data-reactid="429">function</span><!-- react-text: 430 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="431"></span><!-- react-text: 432 -->) <!-- /react-text --></span><!-- react-text: 433 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="434">this</span><!-- react-text: 435 -->.response.body = <!-- /react-text --><span class="hljs-string" data-reactid="436">&#x27;Hello world!&#x27;</span><!-- react-text: 437 -->;
});
<!-- /react-text --></code></pre><!-- react-text: 438 -->
<!-- /react-text --><p data-reactid="439"><!-- react-text: 440 -->Notice the simpler middleware function signatures. In Koa each middleware function’s calling context is set dynamically at runtime. The <!-- /react-text --><a href="http://koajs.com/#context" data-reactid="441">context</a><!-- react-text: 442 --> internally has references to the active <!-- /react-text --><code data-reactid="443">request</code><!-- react-text: 444 --> and <!-- /react-text --><code data-reactid="445">response</code><!-- react-text: 446 --> objects.<!-- /react-text --></p><!-- react-text: 447 -->
<!-- /react-text --><p data-reactid="448"><!-- react-text: 449 -->The <!-- /react-text --><code data-reactid="450">next</code><!-- react-text: 451 --> callback is still used. However, because it is also a generator function it is <!-- /react-text --><code data-reactid="452">yield</code><!-- react-text: 453 -->-ed in order to be executed. This allows for an interesting emergent property - a Koa middleware function can pause execution, allow for other middleware further down the chain to execute, and then resume executing at a later point.<!-- /react-text --></p><!-- react-text: 454 -->
<!-- /react-text --><p data-reactid="455">We see this most clearly with the error handling middleware, which is now the first in the chain:</p><!-- react-text: 456 -->
<!-- /react-text --><pre data-reactid="457"><code class="language-js hljs" data-reactid="458"><!-- react-text: 459 -->app.use(<!-- /react-text --><span class="hljs-function" data-reactid="460"><span class="hljs-keyword" data-reactid="461">function</span><!-- react-text: 462 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="463">next</span><!-- react-text: 464 -->) <!-- /react-text --></span><!-- react-text: 465 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="466">try</span><!-- react-text: 467 --> {
    <!-- /react-text --><span class="hljs-comment" data-reactid="468">// execute the next middleware in the chain</span><!-- react-text: 469 -->
    <!-- /react-text --><span class="hljs-keyword" data-reactid="470">yield</span><!-- react-text: 471 --> next;
    <!-- /react-text --><span class="hljs-comment" data-reactid="472">// if no errors get thrown then we end up here</span><!-- react-text: 473 -->
  } <!-- /react-text --><span class="hljs-keyword" data-reactid="474">catch</span><!-- react-text: 475 --> (err) {
    <!-- /react-text --><span class="hljs-comment" data-reactid="476">// if errors get thrown we end up here</span><!-- react-text: 477 -->
    <!-- /react-text --><span class="hljs-keyword" data-reactid="478">this</span><!-- react-text: 479 -->.response.send(err.toString());
  }
});
<!-- /react-text --></code></pre><!-- react-text: 480 -->
<!-- /react-text --><p data-reactid="481"><!-- react-text: 482 -->And notice how we don’t need to pass errors to the <!-- /react-text --><code data-reactid="483">next</code><!-- react-text: 484 --> callback - we can just <!-- /react-text --><code data-reactid="485">throw</code><!-- react-text: 486 --> them instead, like we do in the secret-checking middleware.<!-- /react-text --></p><!-- react-text: 487 -->
<!-- /react-text --><p data-reactid="488">Perhaps we want to add middleware which compresses all response output before sending it down. We could add it after the error handler middleware as such:</p><!-- react-text: 489 -->
<!-- /react-text --><pre data-reactid="490"><code class="language-js hljs" data-reactid="491"><!-- react-text: 492 -->app.use(<!-- /react-text --><span class="hljs-function" data-reactid="493"><span class="hljs-keyword" data-reactid="494">function</span><!-- react-text: 495 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="496">next</span><!-- react-text: 497 -->) <!-- /react-text --></span><!-- react-text: 498 -->{
  <!-- /react-text --><span class="hljs-comment" data-reactid="499">// execute remainder of chain first</span><!-- react-text: 500 -->
  <!-- /react-text --><span class="hljs-keyword" data-reactid="501">yield</span><!-- react-text: 502 --> next;
  
  <!-- /react-text --><span class="hljs-comment" data-reactid="503">// if response is set</span><!-- react-text: 504 -->
  <!-- /react-text --><span class="hljs-keyword" data-reactid="505">if</span><!-- react-text: 506 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="507">this</span><!-- react-text: 508 -->.response.body) {
    <!-- /react-text --><span class="hljs-comment" data-reactid="509">// compress it</span><!-- react-text: 510 -->
    <!-- /react-text --><span class="hljs-keyword" data-reactid="511">this</span><!-- react-text: 512 -->.response.body = compress(<!-- /react-text --><span class="hljs-keyword" data-reactid="513">this</span><!-- react-text: 514 -->.response.body);
  }
});
<!-- /react-text --></code></pre><!-- react-text: 515 -->
<!-- /react-text --><p data-reactid="516"><!-- react-text: 517 -->To accomplish the above in Express we would need for the compression middleware to override the <!-- /react-text --><code data-reactid="518">res</code><!-- react-text: 519 --> object data writing methods, a hacky solution compared to the one above.<!-- /react-text --></p><!-- react-text: 520 -->
<!-- /react-text --><p data-reactid="521">Thus Koa’s middleware architecture based on generators gives us the following key benefits:</p><!-- react-text: 522 -->
<!-- /react-text --><ul data-reactid="523"><!-- react-text: 524 -->
<!-- /react-text --><li data-reactid="525">Complex middleware composition (i.e. where execution jumps back and forth) is possible, allowing for complex logic to elegantly expressed.</li><!-- react-text: 526 -->
<!-- /react-text --><li data-reactid="527">Throwing and handling errors is simpler to do in Koa.</li><!-- react-text: 528 -->
<!-- /react-text --></ul><!-- react-text: 529 -->
<!-- /react-text --><p data-reactid="530"><!-- react-text: 531 -->Additionally, since Koa middleware are generator functions we can internally <!-- /react-text --><code data-reactid="532">yield</code><!-- react-text: 533 --> promises, thunks and other asynchronous objects, enabling us to write asynchronous code elegantly without callbacks.<!-- /react-text --></p><!-- react-text: 534 -->
<!-- /react-text --><h2 data-reactid="535">Waigo builds on Koa</h2><!-- react-text: 536 -->
<!-- /react-text --><p data-reactid="537">Waigo is built on top of Koa and is itself written using ES6 technologies. Koa’s ES6-based architecture allows for complex middleware patterns that aren’t as easy to do in Express.</p><!-- react-text: 538 -->
<!-- /react-text --><p data-reactid="539">Waigo route handlers and middleware functions work identically to Koa’s, except that you the middleware function context also holds references to other parts of your Waigo app.</p><!-- react-text: 540 -->
<!-- /react-text --><p data-reactid="541">Here is an example route handler taken from Waigo’s source code. This handler marks a user’s email address as verified (after they’ve clicked a link we’ve sent to them via email):</p><!-- react-text: 542 -->
<!-- /react-text --><pre data-reactid="543"><code class="language-js hljs" data-reactid="544"><!-- react-text: 545 -->exports.verify_email = <!-- /react-text --><span class="hljs-function" data-reactid="546"><span class="hljs-keyword" data-reactid="547">function</span><!-- react-text: 548 -->*(<!-- /react-text --><span class="hljs-params" data-reactid="549"></span><!-- react-text: 550 -->) <!-- /react-text --></span><!-- react-text: 551 -->{
  <!-- /react-text --><span class="hljs-keyword" data-reactid="552">let</span><!-- react-text: 553 --> action = <!-- /react-text --><span class="hljs-keyword" data-reactid="554">yield</span><!-- react-text: 555 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="556">this</span><!-- react-text: 557 -->.App.actionTokens.process(
    <!-- /react-text --><span class="hljs-keyword" data-reactid="558">this</span><!-- react-text: 559 -->.request.query.c, {
      <!-- /react-text --><span class="hljs-attr" data-reactid="560">type</span><!-- react-text: 561 -->: <!-- /react-text --><span class="hljs-string" data-reactid="562">&#x27;verify_email&#x27;</span><!-- react-text: 563 -->
    }
  );
  
  <!-- /react-text --><span class="hljs-keyword" data-reactid="564">this</span><!-- react-text: 565 -->.logger.debug(<!-- /react-text --><span class="hljs-string" data-reactid="566">&#x27;Verify email address&#x27;</span><!-- react-text: 567 -->, action.user.id, action.data.email);

  <!-- /react-text --><span class="hljs-comment" data-reactid="568">// verify email address</span><!-- react-text: 569 -->
  <!-- /react-text --><span class="hljs-keyword" data-reactid="570">yield</span><!-- react-text: 571 --> action.user.verifyEmail(action.data.email);

  <!-- /react-text --><span class="hljs-comment" data-reactid="572">// log the user in</span><!-- react-text: 573 -->
  <!-- /react-text --><span class="hljs-keyword" data-reactid="574">yield</span><!-- react-text: 575 --> action.user.login(<!-- /react-text --><span class="hljs-keyword" data-reactid="576">this</span><!-- react-text: 577 -->);

  <!-- /react-text --><span class="hljs-keyword" data-reactid="578">yield</span><!-- react-text: 579 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="580">this</span><!-- react-text: 581 -->.render(<!-- /react-text --><span class="hljs-string" data-reactid="582">&#x27;index&#x27;</span><!-- react-text: 583 -->, {
    <!-- /react-text --><span class="hljs-attr" data-reactid="584">alert</span><!-- react-text: 585 -->: <!-- /react-text --><span class="hljs-string" data-reactid="586">&#x27;Your email address has been verified&#x27;</span><!-- react-text: 587 -->
  });
};
<!-- /react-text --></code></pre><!-- react-text: 588 -->
<!-- /react-text --><p data-reactid="589"><!-- react-text: 590 -->You’ll notice the handler context object has a no. of properties not present in Koa - <!-- /react-text --><code data-reactid="591">this.App</code><!-- react-text: 592 -->, <!-- /react-text --><code data-reactid="593">this.logger</code><!-- react-text: 594 -->, <!-- /react-text --><code data-reactid="595">this.render</code><!-- react-text: 596 -->, etc. We’ll go over each of these in more detail in later sections of this guide.<!-- /react-text --></p><!-- react-text: 597 -->
<!-- /react-text --></div></div><div class="prev-next" data-reactid="598"><a class="prev" href="/docs/introduction/motivation/" data-reactid="599"><!-- react-text: 600 -->« <!-- /react-text --><!-- react-text: 601 -->Introduction: Motivation<!-- /react-text --></a><a class="next" href="/docs/introduction/folderstructure/" data-reactid="602"><!-- react-text: 603 -->Introduction: Folder structure<!-- /react-text --><!-- react-text: 604 --> »<!-- /react-text --></a></div></section></main><footer data-reactid="605"><p class="tagline quoted" data-reactid="606">Node.js ES6 framework for reactive, data-driven apps and APIs</p><div class="credits" data-reactid="607"><!-- react-text: 608 -->Icons made by <!-- /react-text --><a href="http://www.freepik.com" title="Freepik" data-reactid="609">Freepik</a><!-- react-text: 610 --> from <!-- /react-text --><a href="http://www.flaticon.com" title="Flaticon" data-reactid="611">www.flaticon.com</a><!-- react-text: 612 --> is licensed by <!-- /react-text --><a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank" data-reactid="613">CC 3.0 BY</a></div><div class="social" data-reactid="614"><a title="Github" href="https://github.com/waigo/waigo" data-reactid="615"><i class="github" data-reactid="616"></i></a><a title="Twitter" href="https://twitter.com/waigojs" data-reactid="617"><i class="twitter" data-reactid="618"></i></a><a title="discuss" href="https://discord.gg/Jf3pGjf" data-reactid="619"><i class="discuss" data-reactid="620"></i></a></div></footer></div></div><script src="/bundle.js?t=1478243317042"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-11640584-17', 'auto');
            ga('send', 'pageview');
          </script></body></html>